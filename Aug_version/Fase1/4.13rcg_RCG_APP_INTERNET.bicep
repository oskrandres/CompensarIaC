
//suscripcion Oscar 18bf3718-f695-4c96-8d45-72dc2e617d2e
//RG Oscar rg-platfr-secuty-privte-trv-i
//suscripcion Compensar 71bcfecb-881e-4957-8d57-800172d61ee6
//RG Compensar rg-platfr-netwrk-centrl-trv-i

// IPGroups (nuevos IDs provistos por Oscar)
param ipGroups_ipgroup_azsnet_aks_externalid string   = '/subscriptions/71bcfecb-881e-4957-8d57-800172d61ee6/resourceGroups/rg-platfr-secuty-privte-trv-i/providers/Microsoft.Network/ipGroups/ipg-secuty-privte-azsnet-aks'
param ipGroups_ipgroup_azsnet_apim_externalid string  = '/subscriptions/71bcfecb-881e-4957-8d57-800172d61ee6/resourceGroups/rg-platfr-secuty-privte-trv-i/providers/Microsoft.Network/ipGroups/ipg-secuty-privte-azsnet-apim'
param ipGroups_ipgroup_azsnet_app_externalid string   = '/subscriptions/71bcfecb-881e-4957-8d57-800172d61ee6/resourceGroups/rg-platfr-secuty-privte-trv-i/providers/Microsoft.Network/ipGroups/ipg-secuty-privte-azsnet-app'
param ipGroups_ipgroup_azsnet_db_externalid string    = '/subscriptions/71bcfecb-881e-4957-8d57-800172d61ee6/resourceGroups/rg-platfr-secuty-privte-trv-i/providers/Microsoft.Network/ipGroups/ipg-secuty-privte-azsnet-db'
param ipGroups_ipgroup_azsnet_dbw_externalid string   = '/subscriptions/71bcfecb-881e-4957-8d57-800172d61ee6/resourceGroups/rg-platfr-secuty-privte-trv-i/providers/Microsoft.Network/ipGroups/ipg-secuty-privte-azsnet-dbw'
param ipGroups_ipgroup_azsnet_dmctrl_externalid string= '/subscriptions/71bcfecb-881e-4957-8d57-800172d61ee6/resourceGroups/rg-platfr-secuty-privte-trv-i/providers/Microsoft.Network/ipGroups/ipg-secuty-privte-azsnet-dmctrl'
param ipGroups_ipgroup_azsnet_dmz_externalid string   = '/subscriptions/71bcfecb-881e-4957-8d57-800172d61ee6/resourceGroups/rg-platfr-secuty-privte-trv-i/providers/Microsoft.Network/ipGroups/ipg-secuty-privte-azsnet-dmz'
param ipGroups_ipgroup_azsnet_st_externalid string    = '/subscriptions/71bcfecb-881e-4957-8d57-800172d61ee6/resourceGroups/rg-platfr-secuty-privte-trv-i/providers/Microsoft.Network/ipGroups/ipg-secuty-privte-azsnet-st'
param ipGroups_ipgroup_azsnet_vault_externalid string = '/subscriptions/71bcfecb-881e-4957-8d57-800172d61ee6/resourceGroups/rg-platfr-secuty-privte-trv-i/providers/Microsoft.Network/ipGroups/ipg-secuty-privte-azsnet-vault'
param ipGroups_ipgroup_azvnet_dvl_i_externalid string = '/subscriptions/71bcfecb-881e-4957-8d57-800172d61ee6/resourceGroups/rg-platfr-secuty-privte-trv-i/providers/Microsoft.Network/ipGroups/ipg-secuty-privte-azvnet-dvl-i'
param ipGroups_ipgroup_azvnet_poc_i_externalid string = '/subscriptions/71bcfecb-881e-4957-8d57-800172d61ee6/resourceGroups/rg-platfr-secuty-privte-trv-i/providers/Microsoft.Network/ipGroups/ipg-secuty-privte-azvnet-poc-i'
param ipGroups_ipgroup_azvnet_prd_i_externalid string = '/subscriptions/71bcfecb-881e-4957-8d57-800172d61ee6/resourceGroups/rg-platfr-secuty-privte-trv-i/providers/Microsoft.Network/ipGroups/ipg-secuty-privte-azvnet-prd-i'
param ipGroups_ipgroup_azvnet_prp_i_externalid string = '/subscriptions/71bcfecb-881e-4957-8d57-800172d61ee6/resourceGroups/rg-platfr-secuty-privte-trv-i/providers/Microsoft.Network/ipGroups/ipg-secuty-privte-azvnet-prp-i'
param ipGroups_ipgroup_azvnet_trv_i_externalid string = '/subscriptions/71bcfecb-881e-4957-8d57-800172d61ee6/resourceGroups/rg-platfr-secuty-privte-trv-i/providers/Microsoft.Network/ipGroups/ipg-secuty-privte-azvnet-trv-i'
param ipGroups_ipgroup_azvnet_tst_i_externalid string = '/subscriptions/71bcfecb-881e-4957-8d57-800172d61ee6/resourceGroups/rg-platfr-secuty-privte-trv-i/providers/Microsoft.Network/ipGroups/ipg-secuty-privte-azvnet-tst-i'
param ipGroups_ipgroup_opvlan_dmctrl_externalid string= '/subscriptions/71bcfecb-881e-4957-8d57-800172d61ee6/resourceGroups/rg-platfr-secuty-privte-trv-i/providers/Microsoft.Network/ipGroups/ipg-secuty-privte-opvlan-dmctrl'
param ipGroups_ipgroup_opvlan_scanng_externalid string= '/subscriptions/71bcfecb-881e-4957-8d57-800172d61ee6/resourceGroups/rg-platfr-secuty-privte-trv-i/providers/Microsoft.Network/ipGroups/ipg-secuty-privte-opvlan-scanng'
param ipGroups_ipgroup_opvlan_testng_externalid string= '/subscriptions/71bcfecb-881e-4957-8d57-800172d61ee6/resourceGroups/rg-platfr-secuty-privte-trv-i/providers/Microsoft.Network/ipGroups/ipg-secuty-privte-opvlan-testng'
param ipGroups_ipgroup_opvlan_vpnsec_externalid string= '/subscriptions/71bcfecb-881e-4957-8d57-800172d61ee6/resourceGroups/rg-platfr-secuty-privte-trv-i/providers/Microsoft.Network/ipGroups/ipg-secuty-privte-opvlan-vpnsec'
param ipGroups_ipgroup_opvlan_wificp_externalid string= '/subscriptions/71bcfecb-881e-4957-8d57-800172d61ee6/resourceGroups/rg-platfr-secuty-privte-trv-i/providers/Microsoft.Network/ipGroups/ipg-secuty-privte-opvlan-wificp'

param firewallPolicyName string = 'afwp-afw-secuty-public-centrl-trv-i'

// Firewall Policy existente
resource fp 'Microsoft.Network/firewallPolicies@2024-05-01' existing = {
  name: firewallPolicyName
}

resource rcg_RCG_APP_INTERNET 'Microsoft.Network/firewallPolicies/ruleCollectionGroups@2024-05-01' = {
  name: 'RCG-APP-INTERNET'
  parent: fp
  properties: {
    priority: 30000
    ruleCollections: [
      // =======================================================
      // rc-az-vnets-to-internet-web-categories (priority 100)
      // =======================================================
      {
        name: 'rc-az-vnets-to-internet-web-categories'
        priority: 100
        ruleCollectionType: 'FirewallPolicyFilterRuleCollection'
        action: { type: 'Allow' }
        rules: [
          // rule-az-vnets-to-cat-computers+technology (Excel)
          {
            name: 'rule-az-vnets-to-cat-computers+technology'
            ruleType: 'ApplicationRule'
            protocols: [
              {
                protocolType: 'Https'
                port: 443
              }
              {
                protocolType: 'Http'
                port: 80
              }
            ]
            webCategories: [ 'computersandtechnology' ]
            terminateTLS: false
            sourceIpGroups: [
              ipGroups_ipgroup_azvnet_dvl_i_externalid
              ipGroups_ipgroup_azvnet_tst_i_externalid
              ipGroups_ipgroup_azvnet_prp_i_externalid
              ipGroups_ipgroup_azvnet_prd_i_externalid
              ipGroups_ipgroup_azvnet_poc_i_externalid
              ipGroups_ipgroup_azvnet_trv_i_externalid
            ]
          }
          // rule-az-vnets-to-cat-information-security (Excel)
          {
            name: 'rule-az-vnets-to-cat-information-security'
            ruleType: 'ApplicationRule'
            protocols: [
              {
                protocolType: 'Https'
                port: 443
              }
            ]
            webCategories: [ 'informationsecurity' ]
            terminateTLS: false
            sourceIpGroups: [
              ipGroups_ipgroup_azvnet_dvl_i_externalid
              ipGroups_ipgroup_azvnet_tst_i_externalid
              ipGroups_ipgroup_azvnet_prp_i_externalid
              ipGroups_ipgroup_azvnet_prd_i_externalid
              ipGroups_ipgroup_azvnet_poc_i_externalid
              ipGroups_ipgroup_azvnet_trv_i_externalid
            ]
          }
        ]
      }

      // =======================================================
      // rc-az-vnets-to-internet-fqdn-tag (priority 110)
      // =======================================================
      {
        name: 'rc-az-vnets-to-internet-fqdn-tag'
        priority: 110
        ruleCollectionType: 'FirewallPolicyFilterRuleCollection'
        action: { type: 'Allow' }
        rules: [
          {
            name: 'rule-az-vnets-to-internet-fqdn-tag-microsoft'
            ruleType: 'ApplicationRule'
            protocols: [
              {
                protocolType: 'Https'
                port: 443
              }
              {
                protocolType: 'Http'
                port: 80
              }
            ]
            fqdnTags: [
              'AppServiceEnvironment'
              'AzureBackup'
              'AzureKubernetesService'
              'HDInsight'
              'MicrosoftActiveProtectionService'
              'Windows365'
              'WindowsDiagnostics'
              'WindowsUpdate'
              'WindowsVirtualDesktop'
              'Office365.Exchange.Optimize'
              'Office365.Exchange.Allow.Required'
              'Office365.Exchange.Default.Required'
              'Office365.Skype.Allow.Required'
              'Office365.Skype.Default.Required'
              'Office365.Skype.Default.NotRequired'
              'Office365.Skype.Allow.NotRequired'
              'Office365.SharePoint.Optimize'
              'Office365.SharePoint.Default.NotRequired'
              'Office365.SharePoint.Default.Required'
              'Office365.Common.Default.NotRequired'
              'Office365.Common.Allow.Required'
              'Office365.Common.Default.Required'
            ]
            terminateTLS: false
            sourceIpGroups: [
              ipGroups_ipgroup_azvnet_dvl_i_externalid
              ipGroups_ipgroup_azvnet_tst_i_externalid
              ipGroups_ipgroup_azvnet_prp_i_externalid
              ipGroups_ipgroup_azvnet_prd_i_externalid
              ipGroups_ipgroup_azvnet_poc_i_externalid
              ipGroups_ipgroup_azvnet_trv_i_externalid
            ]
          }
        ]
      }

      // =======================================================
      // rc-az-vnets-to-internet-url (priority 120)
      // =======================================================
      {
        name: 'rc-az-vnets-to-internet-url'
        priority: 120
        ruleCollectionType: 'FirewallPolicyFilterRuleCollection'
        action: { type: 'Allow' }
        rules: [
          // === Bloque de dominios corporativos y terceros (Excel) ===
          {
            name: 'rule-az-vnets-to-*.compensar.com'
            ruleType: 'ApplicationRule'
            protocols: [ { protocolType: 'Https', port: 443 } ]
            targetFqdns: [ '*.compensar.com' ]
            terminateTLS: false
            sourceIpGroups: [
              ipGroups_ipgroup_azvnet_dvl_i_externalid
              ipGroups_ipgroup_azvnet_tst_i_externalid
              ipGroups_ipgroup_azvnet_prp_i_externalid
              ipGroups_ipgroup_azvnet_prd_i_externalid
              ipGroups_ipgroup_azvnet_poc_i_externalid
              ipGroups_ipgroup_azvnet_trv_i_externalid
            ]
          }
          {
            name: 'rule-az-vnets-to-*.compensar.co'
            ruleType: 'ApplicationRule'
            protocols: [ { protocolType: 'Https', port: 443 } ]
            targetFqdns: [ '*.compensar.co' ]
            terminateTLS: false
            sourceIpGroups: [
              ipGroups_ipgroup_azvnet_dvl_i_externalid
              ipGroups_ipgroup_azvnet_tst_i_externalid
              ipGroups_ipgroup_azvnet_prp_i_externalid
              ipGroups_ipgroup_azvnet_prd_i_externalid
              ipGroups_ipgroup_azvnet_poc_i_externalid
              ipGroups_ipgroup_azvnet_trv_i_externalid
            ]
          }
          {
            name: 'rule-az-vnets-to-*.compensarsalud.com'
            ruleType: 'ApplicationRule'
            protocols: [ { protocolType: 'Https', port: 443 } ]
            targetFqdns: [ '*.compensarsalud.com' ]
            terminateTLS: false
            sourceIpGroups: [
              ipGroups_ipgroup_azvnet_dvl_i_externalid
              ipGroups_ipgroup_azvnet_tst_i_externalid
              ipGroups_ipgroup_azvnet_prp_i_externalid
              ipGroups_ipgroup_azvnet_prd_i_externalid
              ipGroups_ipgroup_azvnet_poc_i_externalid
              ipGroups_ipgroup_azvnet_trv_i_externalid
            ]
          }
          {
            name: 'rule-az-vnets-to-*.prucompensarsalud.com'
            ruleType: 'ApplicationRule'
            protocols: [ { protocolType: 'Https', port: 443 } ]
            targetFqdns: [ '*.prucompensarsalud.com' ]
            terminateTLS: false
            sourceIpGroups: [
              ipGroups_ipgroup_azvnet_dvl_i_externalid
              ipGroups_ipgroup_azvnet_tst_i_externalid
              ipGroups_ipgroup_azvnet_prp_i_externalid
              ipGroups_ipgroup_azvnet_prd_i_externalid
              ipGroups_ipgroup_azvnet_poc_i_externalid
              ipGroups_ipgroup_azvnet_trv_i_externalid
            ]
          }
          {
            name: 'rule-az-vnets-to-*.prdaws.compensar.com'
            ruleType: 'ApplicationRule'
            protocols: [ { protocolType: 'Https', port: 443 } ]
            targetFqdns: [ '*.pruaws.compensar.co' ] // Excel lo trae así en esa fila
            terminateTLS: false
            sourceIpGroups: [
              ipGroups_ipgroup_azvnet_dvl_i_externalid
              ipGroups_ipgroup_azvnet_tst_i_externalid
              ipGroups_ipgroup_azvnet_prp_i_externalid
              ipGroups_ipgroup_azvnet_prd_i_externalid
              ipGroups_ipgroup_azvnet_poc_i_externalid
              ipGroups_ipgroup_azvnet_trv_i_externalid
            ]
          }
          {
            name: 'rule-az-vnets-to-*.pruaws.compensar.co'
            ruleType: 'ApplicationRule'
            protocols: [ { protocolType: 'Https', port: 443 } ]
            targetFqdns: [ '*.prdaws.compensar.com' ] // y viceversa, según Excel
            terminateTLS: false
            sourceIpGroups: [
              ipGroups_ipgroup_azvnet_dvl_i_externalid
              ipGroups_ipgroup_azvnet_tst_i_externalid
              ipGroups_ipgroup_azvnet_prp_i_externalid
              ipGroups_ipgroup_azvnet_prd_i_externalid
              ipGroups_ipgroup_azvnet_poc_i_externalid
              ipGroups_ipgroup_azvnet_trv_i_externalid
            ]
          }
          {
            name: 'rule-az-vnets-to-*.microsoft.com'
            ruleType: 'ApplicationRule'
            protocols: [ { protocolType: 'Https', port: 443 } ]
            targetFqdns: [ '*.microsoft.com' ]
            terminateTLS: false
            sourceIpGroups: [
              ipGroups_ipgroup_azvnet_dvl_i_externalid
              ipGroups_ipgroup_azvnet_tst_i_externalid
              ipGroups_ipgroup_azvnet_prp_i_externalid
              ipGroups_ipgroup_azvnet_prd_i_externalid
              ipGroups_ipgroup_azvnet_poc_i_externalid
              ipGroups_ipgroup_azvnet_trv_i_externalid
            ]
          }
          {
            name: 'rule-az-vnets-to-*.smtp-mail.outlook.com'
            ruleType: 'ApplicationRule'
            protocols: [
              { protocolType: 'Https', port: 587 }
              { protocolType: 'Https', port: 443 }
            ]
            targetFqdns: [ '*.outlook.com' ]
            terminateTLS: false
            sourceIpGroups: [
              ipGroups_ipgroup_azvnet_dvl_i_externalid
              ipGroups_ipgroup_azvnet_tst_i_externalid
              ipGroups_ipgroup_azvnet_prp_i_externalid
              ipGroups_ipgroup_azvnet_prd_i_externalid
              ipGroups_ipgroup_azvnet_poc_i_externalid
              ipGroups_ipgroup_azvnet_trv_i_externalid
            ]
          }
          {
            name: 'rule-az-vnets-to-*.smtp-office365.com'
            ruleType: 'ApplicationRule'
            protocols: [
              { protocolType: 'Https', port: 587 }
              { protocolType: 'Https', port: 443 }
            ]
            targetFqdns: [ '*.office365.com' ]
            terminateTLS: false
            sourceIpGroups: [
              ipGroups_ipgroup_azvnet_dvl_i_externalid
              ipGroups_ipgroup_azvnet_tst_i_externalid
              ipGroups_ipgroup_azvnet_prp_i_externalid
              ipGroups_ipgroup_azvnet_prd_i_externalid
              ipGroups_ipgroup_azvnet_poc_i_externalid
              ipGroups_ipgroup_azvnet_trv_i_externalid
            ]
          }
          {
            name: 'rule-az-vnets-to-*.google.com'
            ruleType: 'ApplicationRule'
            protocols: [ { protocolType: 'Https', port: 443 } ]
            targetFqdns: [ '*.google.com' ]
            terminateTLS: false
            sourceIpGroups: [
              ipGroups_ipgroup_azvnet_dvl_i_externalid
              ipGroups_ipgroup_azvnet_tst_i_externalid
              ipGroups_ipgroup_azvnet_prp_i_externalid
              ipGroups_ipgroup_azvnet_prd_i_externalid
              ipGroups_ipgroup_azvnet_poc_i_externalid
              ipGroups_ipgroup_azvnet_trv_i_externalid
            ]
          }
          {
            name: 'rule-az-vnets-to-*.googleapis.com'
            ruleType: 'ApplicationRule'
            protocols: [ { protocolType: 'Https', port: 443 } ]
            targetFqdns: [ '*.googleapis.com' ]
            terminateTLS: false
            sourceIpGroups: [
              ipGroups_ipgroup_azvnet_dvl_i_externalid
              ipGroups_ipgroup_azvnet_tst_i_externalid
              ipGroups_ipgroup_azvnet_prp_i_externalid
              ipGroups_ipgroup_azvnet_prd_i_externalid
              ipGroups_ipgroup_azvnet_poc_i_externalid
              ipGroups_ipgroup_azvnet_trv_i_externalid
            ]
          }
          {
            name: 'rule-az-vnets-to-*.gserviceaccount.com'
            ruleType: 'ApplicationRule'
            protocols: [ { protocolType: 'Https', port: 443 } ]
            targetFqdns: [ '*.gserviceaccount.com' ]
            terminateTLS: false
            sourceIpGroups: [
              ipGroups_ipgroup_azvnet_dvl_i_externalid
              ipGroups_ipgroup_azvnet_tst_i_externalid
              ipGroups_ipgroup_azvnet_prp_i_externalid
              ipGroups_ipgroup_azvnet_prd_i_externalid
              ipGroups_ipgroup_azvnet_poc_i_externalid
              ipGroups_ipgroup_azvnet_trv_i_externalid
            ]
          }
          {
            name: 'rule-az-vnets-to-*.kaspersky.com'
            ruleType: 'ApplicationRule'
            protocols: [ { protocolType: 'Https', port: 443 } ]
            targetFqdns: [ '*.kaspersky.com' ]
            terminateTLS: false
            sourceIpGroups: [
              ipGroups_ipgroup_azvnet_dvl_i_externalid
              ipGroups_ipgroup_azvnet_tst_i_externalid
              ipGroups_ipgroup_azvnet_prp_i_externalid
              ipGroups_ipgroup_azvnet_prd_i_externalid
              ipGroups_ipgroup_azvnet_poc_i_externalid
              ipGroups_ipgroup_azvnet_trv_i_externalid
            ]
          }
          {
            name: 'rule-az-vnets-to-*.debian.org'
            ruleType: 'ApplicationRule'
            protocols: [
              { protocolType: 'Https', port: 443 }
              { protocolType: 'Http',  port: 80 }
            ]
            targetFqdns: [ '*.debian.org' ]
            terminateTLS: false
            sourceIpGroups: [
              ipGroups_ipgroup_azvnet_dvl_i_externalid
              ipGroups_ipgroup_azvnet_tst_i_externalid
              ipGroups_ipgroup_azvnet_prp_i_externalid
              ipGroups_ipgroup_azvnet_prd_i_externalid
              ipGroups_ipgroup_azvnet_poc_i_externalid
              ipGroups_ipgroup_azvnet_trv_i_externalid
            ]
          }
          {
            name: 'rule-az-vnets-to-*.licensing.tableau.com'
            ruleType: 'ApplicationRule'
            protocols: [
              { protocolType: 'Https', port: 443 }
              { protocolType: 'Http',  port: 80 }
            ]
            targetFqdns: [ '*.licensing.tableau.com' ]
            terminateTLS: false
            sourceIpGroups: [
              ipGroups_ipgroup_azvnet_dvl_i_externalid
              ipGroups_ipgroup_azvnet_tst_i_externalid
              ipGroups_ipgroup_azvnet_prp_i_externalid
              ipGroups_ipgroup_azvnet_prd_i_externalid
              ipGroups_ipgroup_azvnet_poc_i_externalid
              ipGroups_ipgroup_azvnet_trv_i_externalid
            ]
          }
          {
            name: 'rule-az-vnets-to-*.stellarcyber.cloud'
            ruleType: 'ApplicationRule'
            protocols: [ { protocolType: 'Https', port: 443 } ]
            targetFqdns: [ '*.stellarcyber.cloud' ]
            terminateTLS: false
            sourceIpGroups: [
              ipGroups_ipgroup_azvnet_dvl_i_externalid
              ipGroups_ipgroup_azvnet_tst_i_externalid
              ipGroups_ipgroup_azvnet_prp_i_externalid
              ipGroups_ipgroup_azvnet_prd_i_externalid
              ipGroups_ipgroup_azvnet_poc_i_externalid
              ipGroups_ipgroup_azvnet_trv_i_externalid
            ]
          }
          {
            name: 'rule-az-vnets-to-*.grupoemi.com'
            ruleType: 'ApplicationRule'
            protocols: [
              { protocolType: 'Https', port: 443 }
              { protocolType: 'Https', port: 6078 }
            ]
            targetFqdns: [ '*.grupoemi.com' ]
            terminateTLS: false
            sourceIpGroups: [
              ipGroups_ipgroup_azvnet_dvl_i_externalid
              ipGroups_ipgroup_azvnet_tst_i_externalid
              ipGroups_ipgroup_azvnet_prp_i_externalid
              ipGroups_ipgroup_azvnet_prd_i_externalid
              ipGroups_ipgroup_azvnet_poc_i_externalid
              ipGroups_ipgroup_azvnet_trv_i_externalid
            ]
          }
          {
            name: 'rule-az-vnets-to-*.e-collect.com'
            ruleType: 'ApplicationRule'
            protocols: [
              { protocolType: 'Https', port: 443 }
              { protocolType: 'Https', port: 445 }
              { protocolType: 'Https', port: 22 }
            ]
            targetFqdns: [ '*.e-collect.com' ]
            terminateTLS: false
            sourceIpGroups: [
              ipGroups_ipgroup_azvnet_dvl_i_externalid
              ipGroups_ipgroup_azvnet_tst_i_externalid
              ipGroups_ipgroup_azvnet_prp_i_externalid
              ipGroups_ipgroup_azvnet_prd_i_externalid
              ipGroups_ipgroup_azvnet_poc_i_externalid
              ipGroups_ipgroup_azvnet_trv_i_externalid
            ]
          }
          {
            name: 'rule-az-vnets-to-*.cloudamqp.com'
            ruleType: 'ApplicationRule'
            protocols: [
              { protocolType: 'Https', port: 443 }
              { protocolType: 'Https', port: 5671 }
              { protocolType: 'Https', port: 5672 }
            ]
            targetFqdns: [ '*.cloudamqp.com' ]
            terminateTLS: false
            sourceIpGroups: [
              ipGroups_ipgroup_azvnet_dvl_i_externalid
              ipGroups_ipgroup_azvnet_tst_i_externalid
              ipGroups_ipgroup_azvnet_prp_i_externalid
              ipGroups_ipgroup_azvnet_prd_i_externalid
              ipGroups_ipgroup_azvnet_poc_i_externalid
              ipGroups_ipgroup_azvnet_trv_i_externalid
            ]
          }
          {
            name: 'rule-az-vnets-to-*.microsoftmetrics.com'
            ruleType: 'ApplicationRule'
            protocols: [
              { protocolType: 'Https', port: 443 }
              { protocolType: 'Https', port: 1886 }
            ]
            targetFqdns: [ '*.microsoftmetrics.com' ]
            terminateTLS: false
            sourceIpGroups: [
              ipGroups_ipgroup_azvnet_dvl_i_externalid
              ipGroups_ipgroup_azvnet_tst_i_externalid
              ipGroups_ipgroup_azvnet_prp_i_externalid
              ipGroups_ipgroup_azvnet_prd_i_externalid
              ipGroups_ipgroup_azvnet_poc_i_externalid
              ipGroups_ipgroup_azvnet_trv_i_externalid
            ]
          }
          {
            name: 'rule-az-vnets-to-*.databricks.azure.com'
            ruleType: 'ApplicationRule'
            protocols: [
              { protocolType: 'Https', port: 443 }
              { protocolType: 'Https', port: 1433 }
              { protocolType: 'Https', port: 3306 }
              { protocolType: 'Https', port: 9093 }
            ]
            targetFqdns: [ '*.databricks.azure.com' ]
            terminateTLS: false
            sourceIpGroups: [
              ipGroups_ipgroup_azvnet_dvl_i_externalid
              ipGroups_ipgroup_azvnet_tst_i_externalid
              ipGroups_ipgroup_azvnet_prp_i_externalid
              ipGroups_ipgroup_azvnet_prd_i_externalid
              ipGroups_ipgroup_azvnet_poc_i_externalid
              ipGroups_ipgroup_azvnet_trv_i_externalid
            ]
          }
          {
            name: 'rule-az-vnets-to-*.databricks.com'
            ruleType: 'ApplicationRule'
            protocols: [
              { protocolType: 'Https', port: 443 }
              { protocolType: 'Https', port: 1433 }
              { protocolType: 'Https', port: 3306 }
              { protocolType: 'Https', port: 9093 }
            ]
            targetFqdns: [ '*.databricks.com' ]
            terminateTLS: false
            sourceIpGroups: [
              ipGroups_ipgroup_azvnet_dvl_i_externalid
              ipGroups_ipgroup_azvnet_tst_i_externalid
              ipGroups_ipgroup_azvnet_prp_i_externalid
              ipGroups_ipgroup_azvnet_prd_i_externalid
              ipGroups_ipgroup_azvnet_poc_i_externalid
              ipGroups_ipgroup_azvnet_trv_i_externalid
            ]
          }
          {
            name: 'rule-az-vnets-to-*.azuredatabricks.net'
            ruleType: 'ApplicationRule'
            protocols: [
              { protocolType: 'Https', port: 443 }
              { protocolType: 'Https', port: 1433 }
              { protocolType: 'Https', port: 3306 }
              { protocolType: 'Https', port: 9093 }
            ]
            targetFqdns: [ '*.azuredatabricks.net' ]
            terminateTLS: false
            sourceIpGroups: [
              ipGroups_ipgroup_azvnet_dvl_i_externalid
              ipGroups_ipgroup_azvnet_tst_i_externalid
              ipGroups_ipgroup_azvnet_prp_i_externalid
              ipGroups_ipgroup_azvnet_prd_i_externalid
              ipGroups_ipgroup_azvnet_poc_i_externalid
              ipGroups_ipgroup_azvnet_trv_i_externalid
            ]
          }
        ]
      }
    ]
  }
}
